#Accelerated Forest Modeling from Tree Canopy Point Clouds via Deep Learning
## Datasets and Result
We provide
* 10-forest dataset for studying tree modeling from crowns, which is stored in the "10-forest" folder.
The dataset consists of 10 forests, and the number of crowns in each forest is as follows:

 | Forest1 | Forest2 | Forest3 | Forest4 | Forest5 | Forest6 | Forest7 | Forest8 | Forest9 | Forest10 |
 |:------:|:------:|:------:|:------:|:------:|:------:|:------:|:------:|:------:|:------:|
 |  357  |  240  |  489  |  218  |  310  |  328  |  311  |  149  |  495  |  319  |
 \
&ensp;&ensp;&ensp; The file storage format is as follows:\
&ensp;&ensp;&ensp; 10-forest — |\
&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;forest1  — |\
&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;
crown — |\
&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;1.npy\
&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;2.npy\
&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;...\
&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;357.npy\
&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;dem.ply\
&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;...\
&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;forest10  — |\
&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;
crown — |\
&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;1.npy\
&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;2.npy\
&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;...\
&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;319.npy\
&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;dem.ply\
&ensp;&ensp;&ensp; \
&ensp;&ensp;&ensp; Each npy file under the crown folder is a (n+1) x 3 matrix, \
&ensp;&ensp;&ensp; where the first n rows represent the points of the crown, \
&ensp;&ensp;&ensp; the last row records the height of the corresponding tree. \
&ensp;&ensp;&ensp; The storage format is as follows:\
&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;x1 &ensp;&ensp; y1 &ensp;&ensp; z1\
&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;x2 &ensp;&ensp; y2 &ensp;&ensp; z2\
&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp; &ensp;&ensp;&ensp;&ensp;&ensp;...\
&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;xn &ensp;&ensp; yn &ensp;&ensp; zn\
&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;——————\
&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;h &ensp;&ensp;&ensp; h &ensp;&ensp;&ensp; h

* The branch graph generated by our proposed method on the 10-forest dataset can be downloaded from: [Our_Result (703.89 MB)](https://pan.baidu.com/s/1DQujOFutj8ketPkinrjFWw) with extraction code: "e6cd". After downloading, place the files in the "Our_Result" folder, and you can view the generated results using "vis_mesh.py" and "vis_forest.py".

* The branch graph generated by the procedural modeling method (baseline method) on the 10-forest dataset can be downloaded from: [Procedural_Result (704.92 MB)](https://pan.baidu.com/s/1vnV_89mhLCbz_yYQIH0WYw) with extraction code: "4rfr". After downloading, place the files in the "Procedural_Result" folder, and you can view the generated results using "vis_mesh.py" and "vis_forest.py".

* The code for calculating "Consistency" and "CLIP-Precision", along with pre-trained CLIP model parameters, are provided. The code is in "metrics.py", and the CLIP parameters can be downloaded from [RN50x16.pt (630.50MB)](https://pan.baidu.com/s/19OkCzBabV4rpM5M7BzDskA) with extraction code: "l14u". After downloading, place the file in the "params" folder.

* Procedural modeling method for generating tree models from crowns can be directly run through "crown_to_tree_by_procedural_model.py". The specific implementation of the method is in the "procedrual_tree_modeling" folder, with most of the code sourced from [Oblique Photogrammetry Supporting Procedural Tree Modeling in Urban Areas](https://github.com/lelleMU/Procedrual_Tree_Modeling), for which we express our sincere gratitude.

## Visualization

Modify the "forest_name" and "item" parameters in the "vis_mesh.py" file as needed, and then run the script. This will allow you to visualize the crowns, the branch graph generated from the crowns, and the tree models derived from the branch graph. 
```pathon
if __name__ == '__main__':
    forest_name = "forest6"
    item = 76
```
![](https://github.com/xujiabo/ForestCanopyToTree/blob/main/assets/trees.jpg)
\
\
Modify the "forest_id" parameter in the "vis_forest.py" file according to your needs, and then run the script. This will enable you to visualize the generated results for the entire forest. 
```pathon
if __name__ == '__main__':
    forest_id = 1
```
![](https://github.com/xujiabo/ForestCanopyToTree/blob/main/assets/3-f.jpg)